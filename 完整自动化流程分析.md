# å®Œæ•´è‡ªåŠ¨åŒ–æµç¨‹åˆ†æ - ä» scrapedHints åˆ° pacedSpeech

## ä¸€ã€å…³é”®å‘ç°ï¼šPre.txt æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼

ç»è¿‡ä»”ç»†åˆ†æ Jupyter Notebookï¼Œå‘ç° **Pre.txt æ–‡ä»¶å®é™…ä¸Šæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„**ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨åˆ›å»ºçš„ï¼

### è‡ªåŠ¨åŒ–æµç¨‹ï¼ˆCell 13ï¼‰

```python
# Cell 13: è‡ªåŠ¨ç”Ÿæˆ Pre.txt æ–‡ä»¶
for i in range(len(hint_to_file)):
    directory_name = f"translation-text-files/pre-translation/conversion-math/math-conversion{i}"
    os.mkdir(directory_name)
    
    for c, hint_chunk in enumerate(hint_to_file[i]):
        filename = f"{directory_name}/onlyMath{i}-{c}Pre.txt"
        
        # è‡ªåŠ¨å†™å…¥ Pre.txt
        with open(filename, 'w', encoding='utf-8') as file:
            for math_hint in hint_chunk:
                file.write(math_hint + ';')  # ç”¨ ; åˆ†éš”æç¤º
            file.write(STOP_WORD)  # æ·»åŠ åœæ­¢è¯
```

**Pre.txt çš„å†…å®¹**ï¼š
- æ¥è‡ª `only_math_hints`ï¼ˆCell 9 è‡ªåŠ¨æå–ï¼‰
- æ ¼å¼ï¼š`LaTeX1@LaTeX2;LaTeX3@LaTeX4;`ï¼ˆç”¨ `;` åˆ†éš”æç¤ºï¼Œç”¨ `@` åˆ†éš”åŒä¸€æç¤ºä¸­çš„å¤šä¸ª LaTeXï¼‰

---

## äºŒã€å®Œæ•´æµç¨‹è§£æ

### æ­¥éª¤ 1ï¼šæå–åŸå§‹æ–‡æœ¬ âœ… è‡ªåŠ¨åŒ–

**Cell 5**: è¿è¡Œ `hintScraper.py`
```python
%run math-to-speech/scripts/hintScraper.py
```
- æ‰«ææ‰€æœ‰ JSON æ–‡ä»¶
- æå– `hint.text` å­—æ®µ
- å†™å…¥ `scrapedHints.txt`

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
The known quantities are $$20$$ and $$0.05$$.
What is $$x$$ times $$y$$?
```

---

### æ­¥éª¤ 2ï¼šé¢„å¤„ç† âœ… è‡ªåŠ¨åŒ–

**Cell 7**: æ›¿æ¢å†²çªå­—ç¬¦
```python
words_to_remove = ['@', ';', '___']
words_replacement = ['', ':', 'blank']
replace_words_in_file(scraped_hints_path, scraped_pre_proc_path, ...)
```
- ç§»é™¤æ–‡æœ¬ä¸­çš„ `@`ã€`;`ã€`___`ï¼ˆé¿å…ä¸æ ¼å¼å†²çªï¼‰
- ç”Ÿæˆ `scrapedHintsProc.txt`

---

### æ­¥éª¤ 3ï¼šæå– LaTeX è¡¨è¾¾å¼ âœ… è‡ªåŠ¨åŒ–

**Cell 9**: æå–æ‰€æœ‰ LaTeX
```python
only_math_hints = []
for hint in hints:
    strings_between_dollars = re.findall(r'\$\$(.*?)\$\$', hint)
    only_math_hints.append('@'.join(strings_between_dollars))  # ç”¨ @ è¿æ¥
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
20@0.05
x@y
```

**æ ¼å¼è¯´æ˜**ï¼š
- æ¯ä¸ªæç¤ºçš„ LaTeX è¡¨è¾¾å¼ç”¨ `@` è¿æ¥
- å¦‚æœæ²¡æœ‰ LaTeXï¼Œåˆ™ä¸º `' '`ï¼ˆç©ºæ ¼ï¼‰

---

### æ­¥éª¤ 4ï¼šåˆ†å‰²æˆå— âœ… è‡ªåŠ¨åŒ–

**Cell 11**: `partition_list()`
```python
CHUNK_SIZE = 2000  # æ¯ä¸ªç›®å½• 2000 ä¸ªæç¤º
INNER_CHUNK_SIZE = 300  # æ¯ä¸ªæ–‡ä»¶ 300 ä¸ªè¡¨è¾¾å¼ï¼ˆMathCAT é™åˆ¶ï¼‰
```
- å°† `only_math_hints` åˆ†å‰²æˆå¤šä¸ªç›®å½•
- æ¯ä¸ªç›®å½•åŒ…å«å¤šä¸ªæ–‡ä»¶
- æ¯ä¸ªæ–‡ä»¶æœ€å¤š 300 ä¸ªè¡¨è¾¾å¼ï¼ˆå› ä¸º MathCAT åªèƒ½å¤„ç†è¿™ä¹ˆå¤šï¼‰

---

### æ­¥éª¤ 5ï¼šç”Ÿæˆ Pre.txt æ–‡ä»¶ âœ… è‡ªåŠ¨åŒ–

**Cell 13**: è‡ªåŠ¨ç”Ÿæˆ Pre.txt
```python
for math_hint in hint_chunk:
    file.write(math_hint + ';')  # ç”¨ ; åˆ†éš”
file.write(STOP_WORD)  # " nyradhej "
```

**Pre.txt æ ¼å¼**ï¼š
```
4@x;4;;;-2y@4y^2;-2y@3y;-2y;;;p@x;p;;;
```

**æ ¼å¼è¯´æ˜**ï¼š
- `;` åˆ†éš”ä¸åŒçš„æç¤ºï¼ˆhintï¼‰
- `@` åˆ†éš”åŒä¸€æç¤ºä¸­çš„å¤šä¸ª LaTeX è¡¨è¾¾å¼
- `;;;` è¡¨ç¤ºç©ºæç¤º
- æœ€åæœ‰ ` nyradhej ` ä½œä¸ºåœæ­¢è¯

---

### æ­¥éª¤ 6ï¼šLaTeX è½¬è¯­éŸ³ âš ï¸ åŠè‡ªåŠ¨åŒ–

**è¿™é‡Œæœ‰ä¸¤ä¸ªè·¯å¾„**ï¼š

#### è·¯å¾„ Aï¼šä½¿ç”¨ MathCATï¼ˆæ‰‹åŠ¨ï¼‰

1. **æ‰‹åŠ¨æ­¥éª¤**ï¼šå°† Pre.txt å†…å®¹ç²˜è´´åˆ° MathCAT
2. **æ‰‹åŠ¨æ­¥éª¤**ï¼šä» MathCAT å¤åˆ¶ç¿»è¯‘ç»“æœ
3. **æ‰‹åŠ¨æ­¥éª¤**ï¼šç²˜è´´åˆ° Post.txt æ–‡ä»¶

**Post.txt æ ¼å¼**ï¼š
```
semicolon 4 at sign x, semicolon 4; semicolon; semicolon; ...
```

#### è·¯å¾„ Bï¼šä½¿ç”¨ SREï¼ˆè‡ªåŠ¨åŒ–ï¼‰âœ…

**è„šæœ¬**ï¼š`sreConverter.py`
```python
# è‡ªåŠ¨å¤„ç†æ‰€æœ‰ Pre.txt æ–‡ä»¶
def process_pre_file(pre_file_path, post_file_path):
    pre_content = read_file(pre_file_path)
    post_content = convert_pre_to_post(pre_content)  # LaTeX â†’ Speech
    write_file(post_file_path, post_content)
```

**å¤„ç†æµç¨‹**ï¼š
1. è¯»å– Pre.txt
2. æå–æ‰€æœ‰ LaTeX è¡¨è¾¾å¼
3. LaTeX â†’ MathML â†’ Speechï¼ˆä½¿ç”¨ SREï¼‰
4. é‡ç»„ä¸º Post.txt æ ¼å¼
5. å†™å…¥ Post.txt

**âœ… è¿™ä¸ªå·²ç»è‡ªåŠ¨åŒ–äº†ï¼**

---

### æ­¥éª¤ 7ï¼šåˆå¹¶ Post.txt æ–‡ä»¶ âœ… è‡ªåŠ¨åŒ–

**Cell 16-17**: `collect_translations()`
```python
def collect_translations(folder_index, write_filepath):
    # åˆå¹¶ç›®å½•ä¸­æ‰€æœ‰ Post.txt æ–‡ä»¶
    for c in range(len(hint_to_file[folder_index])):
        read_filepath = f"onlyMath{i}-{c}Post.txt"
        # è¯»å–å¹¶è¿½åŠ åˆ° post-{i}.txt
```

---

### æ­¥éª¤ 8ï¼šå°†è½¬æ¢åçš„ LaTeX æ”¾å›å®Œæ•´æç¤º âœ… è‡ªåŠ¨åŒ–

**Cell 18**: `translation_process()`
```python
def put_math_in_hints(indexes, math):
    # å°†è½¬æ¢åçš„ LaTeX æ›¿æ¢å›åŸå§‹æç¤º
    for replacement in math_replacements:
        hints_done[i] = re.sub(r'\$\$.*?\$\$', replacement, hints_done[i], count=1)
```

**è¾“å‡º**ï¼š`translatedHints.txt`
```
The known quantities are 20 and 0.05.
What is x times y?
```

---

### æ­¥éª¤ 9ï¼šç”Ÿæˆ pacedSpeech âš ï¸ åŠè‡ªåŠ¨åŒ–

**Cell 28**: `self_paced_parsing()` + `paced_math_in_hints()`

**æµç¨‹**ï¼š
1. **è§£ææç¤º**ï¼ˆè‡ªåŠ¨åŒ–ï¼‰ï¼š
   ```python
   def self_paced_parsing():
       # åˆ†å‰²æ–‡æœ¬å’Œ LaTeX
       strings_not_between_dollars = re.split(r'\$\$.*?\$\$', hint)
       strings_between_dollars = re.findall(r'\$\$(.*?)\$\$', hint)
   ```

2. **ç»„åˆ pacedSpeech**ï¼ˆè‡ªåŠ¨åŒ–ï¼‰ï¼š
   ```python
   def paced_math_in_hints(indexes, math):
       # å°†è½¬æ¢åçš„ LaTeX æ’å…¥åˆ°æ–‡æœ¬æ®µä¹‹é—´
       hints_done[i][r] = f"{hints_done[i][r]} {expression}"
   ```

3. **å†™å…¥æ–‡ä»¶**ï¼ˆè‡ªåŠ¨åŒ–ï¼‰ï¼š
   ```python
   def paced_write_final_product(translated_hints, finished_file_path):
       # å†™å…¥ pacedTranslatedHintsPost.txt
   ```

**âš ï¸ é—®é¢˜**ï¼šCell 28 ä¸­çš„ `paced_write_final_product()` å‡½æ•°æœ‰é—®é¢˜ï¼š
```python
file.write(hint.join())  # âŒ é”™è¯¯ï¼šjoin() éœ€è¦å‚æ•°
```

**åº”è¯¥æ˜¯**ï¼š
```python
file.write('Â£'.join(hint))  # ç”¨ Â£ åˆ†éš”æ®µ
```

---

### æ­¥éª¤ 10ï¼šå†™å…¥ JSON æ–‡ä»¶ âœ… è‡ªåŠ¨åŒ–

**è„šæœ¬**ï¼š`mtsPacedWriter.py`
```python
hints = [hint.strip().split('Â£') for hint in file.readlines()]
for obj in data:
    obj['pacedSpeech'] = hints[i]  # ç›´æ¥èµ‹å€¼æ•°ç»„
```

---

## ä¸‰ã€æ‰‹åŠ¨æ­¥éª¤æ€»ç»“

### âŒ çœŸæ­£çš„æ‰‹åŠ¨æ­¥éª¤

1. **ä½¿ç”¨ MathCAT è·¯å¾„æ—¶**ï¼š
   - å°† Pre.txt ç²˜è´´åˆ° MathCAT
   - ä» MathCAT å¤åˆ¶ç»“æœåˆ° Post.txt

2. **ä½¿ç”¨ SRE è·¯å¾„æ—¶**ï¼š
   - âœ… **å®Œå…¨è‡ªåŠ¨åŒ–**ï¼`sreConverter.py` å·²ç»å®ç°äº†

### âš ï¸ éœ€è¦ä¿®å¤çš„é—®é¢˜

1. **Cell 28 çš„ `paced_write_final_product()` å‡½æ•°**ï¼š
   ```python
   # å½“å‰ï¼ˆé”™è¯¯ï¼‰
   file.write(hint.join())
   
   # åº”è¯¥æ”¹ä¸º
   file.write('Â£'.join(hint) + '\n')
   ```

2. **å®Œæ•´çš„ pacedSpeech ç”Ÿæˆæµç¨‹**ï¼š
   - éœ€è¦ç¡®ä¿æ‰€æœ‰æ­¥éª¤éƒ½æ­£ç¡®è¿æ¥
   - éœ€è¦æµ‹è¯•æ•´ä¸ªæµç¨‹

---

## å››ã€å®Œå…¨è‡ªåŠ¨åŒ–çš„æ–¹æ¡ˆ

### æ–¹æ¡ˆï¼šç›´æ¥ä½¿ç”¨ SREï¼Œè·³è¿‡ MathCAT

**å®Œæ•´è‡ªåŠ¨åŒ–æµç¨‹**ï¼š

```
JSONæ–‡ä»¶ï¼ˆtextå­—æ®µï¼‰
  â†“
hintScraper.py - æå–æ‰€æœ‰ text
  â†“
scrapedHints.txt
  â†“
é¢„å¤„ç† - ç§»é™¤å†²çªå­—ç¬¦
  â†“
æå– LaTeX - ç”Ÿæˆ only_math_hints
  â†“
sreConverter.py - ç›´æ¥å¤„ç†ï¼ˆè·³è¿‡ Pre.txt/Post.txt æ–‡ä»¶ï¼‰
  â†“
ç”Ÿæˆ pacedSpeech æ•°ç»„
  â†“
æ›´æ–° JSON æ–‡ä»¶
```

### å®ç°ä»£ç 

```javascript
// autoProcessor.js
function generatePacedSpeechFromText(text) {
    // 1. åˆ†å‰²æ–‡æœ¬å’Œ LaTeX
    const parts = text.split(/(\$\$.*?\$\$)/);
    
    const segments = [];
    for (const part of parts) {
        if (part.startsWith('$$') && part.endsWith('$$')) {
            // LaTeX â†’ Speechï¼ˆä½¿ç”¨ SREï¼‰
            const latex = part.replace(/\$\$/g, '');
            const speech = latexToSpeech(latex);  // è°ƒç”¨ sreNode.js
            segments.push(speech);
        } else if (part.trim()) {
            // æ–‡æœ¬éƒ¨åˆ†
            segments.push(part.trim());
        }
    }
    
    return segments;
}

// å¤„ç†æ‰€æœ‰ JSON æ–‡ä»¶
function processAllContent() {
    const files = findAllPathwayFiles();
    
    for (const file of files) {
        const data = JSON.parse(fs.readFileSync(file));
        
        for (const hint of data) {
            if (!hint.pacedSpeech || hint.pacedSpeech.length === 0) {
                hint.pacedSpeech = generatePacedSpeechFromText(hint.text);
            }
        }
        
        fs.writeFileSync(file, JSON.stringify(data, null, 2));
    }
}
```

---

## äº”ã€å…³é”®å‘ç°æ€»ç»“

### âœ… å·²è‡ªåŠ¨åŒ–çš„éƒ¨åˆ†

1. **Pre.txt ç”Ÿæˆ**ï¼šCell 13 è‡ªåŠ¨ç”Ÿæˆ
2. **SRE è½¬æ¢**ï¼š`sreConverter.py` å®Œå…¨è‡ªåŠ¨åŒ–
3. **pacedSpeech ç”Ÿæˆé€»è¾‘**ï¼šCell 28 å·²å®ç°ï¼ˆä½†å†™å…¥å‡½æ•°æœ‰ bugï¼‰

### âŒ æ‰‹åŠ¨æ­¥éª¤

1. **ä½¿ç”¨ MathCAT æ—¶**ï¼šéœ€è¦æ‰‹åŠ¨ç²˜è´´ï¼ˆä½†å¯ä»¥ç”¨ SRE æ›¿ä»£ï¼‰
2. **Cell 28 çš„ bug**ï¼šéœ€è¦ä¿®å¤ `paced_write_final_product()`

### ğŸ¯ å®Œå…¨è‡ªåŠ¨åŒ–çš„å…³é”®

**ä½¿ç”¨ SRE è€Œä¸æ˜¯ MathCAT**ï¼š
- âœ… SRE è½¬æ¢å·²å®Œå…¨è‡ªåŠ¨åŒ–
- âœ… å¯ä»¥ç›´æ¥ä» JSON çš„ `text` å­—æ®µç”Ÿæˆ `pacedSpeech`
- âœ… æ— éœ€ä¸­é—´æ–‡ä»¶ï¼ˆPre.txt/Post.txtï¼‰
- âœ… å¯ä»¥é›†æˆåˆ°æ„å»ºæµç¨‹

---

## å…­ã€æ¨èå®æ–½æ–¹æ¡ˆ

### æ–¹æ¡ˆ Aï¼šä¿®å¤ç°æœ‰æµç¨‹ï¼ˆå¿«é€Ÿï¼‰

1. ä¿®å¤ Cell 28 çš„ `paced_write_final_product()` å‡½æ•°
2. ä½¿ç”¨ SRE è€Œä¸æ˜¯ MathCATï¼ˆå·²å®ç°ï¼‰
3. è¿è¡Œå®Œæ•´çš„ Notebook æµç¨‹

### æ–¹æ¡ˆ Bï¼šåˆ›å»ºæ–°çš„è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰

1. åˆ›å»º `autoProcessor.js`
2. ç›´æ¥ä» JSON æ–‡ä»¶ç”Ÿæˆ `pacedSpeech`
3. ä½¿ç”¨ç°æœ‰çš„ SRE è½¬æ¢ï¼ˆ`sreNode.js`ï¼‰
4. é›†æˆåˆ°æ„å»ºæµç¨‹

**ä¼˜åŠ¿**ï¼š
- âœ… å®Œå…¨è‡ªåŠ¨åŒ–
- âœ… æ— éœ€ä¸­é—´æ–‡ä»¶
- âœ… æ›´ç®€å•ç›´æ¥
- âœ… æ˜“äºç»´æŠ¤

---

## ä¸ƒã€ç»“è®º

**å…³é”®å‘ç°**ï¼š
1. âœ… Pre.txt **æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„**ï¼ˆCell 13ï¼‰
2. âœ… SRE è½¬æ¢**å·²å®Œå…¨è‡ªåŠ¨åŒ–**ï¼ˆ`sreConverter.py`ï¼‰
3. âš ï¸ pacedSpeech ç”Ÿæˆé€»è¾‘å·²å®ç°ï¼Œä½†å†™å…¥å‡½æ•°æœ‰ bug
4. âŒ å¦‚æœä½¿ç”¨ MathCATï¼Œéœ€è¦æ‰‹åŠ¨ç²˜è´´ï¼ˆä½†å¯ä»¥ç”¨ SRE æ›¿ä»£ï¼‰

**æ¨èæ–¹æ¡ˆ**ï¼š
- åˆ›å»ºæ–°çš„ `autoProcessor.js`ï¼Œç›´æ¥ä» JSON ç”Ÿæˆ `pacedSpeech`
- ä½¿ç”¨ç°æœ‰çš„ SRE è½¬æ¢
- å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨æ­¥éª¤




